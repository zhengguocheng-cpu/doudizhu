# 重启后端服务器指南

## 🔄 为什么需要重启

修改了TypeScript代码后，需要重新编译和重启服务器才能生效。

## 📝 重启步骤

### 1. 停止当前后端服务
在运行后端的终端中按 `Ctrl+C` 停止服务

### 2. 清理旧的编译文件（可选但推荐）
```bash
cd backend
rm -rf dist
```

### 3. 重新启动后端
```bash
cd backend
npm run dev
```

### 4. 验证服务器启动成功
查看终端输出，应该看到：
```
✅ Socket.IO服务器已启动
🚀 服务器运行在 http://localhost:3000
```

### 5. 刷新所有浏览器页面
- 玩家1页面：按 F5 或 Ctrl+R
- 玩家2页面：按 F5 或 Ctrl+R  
- 玩家3页面：按 F5 或 Ctrl+R

## 🧪 测试步骤

1. 重新开始游戏
2. 抢地主
3. 玩家1出牌
4. **检查玩家2和玩家3的界面是否更新**

## 🔍 调试技巧

### 查看后端日志
后端终端应该显示：
```
🎴 玩家 玩家1 尝试出牌: [ '♠5', '♥5' ]
✅ 玩家 玩家1 出牌成功: [ '♠5', '♥5' ]
   牌型: PAIR, 剩余: 18张
```

### 查看前端控制台
打开浏览器开发者工具（F12），在Console中应该看到：
```
🎴 [出牌] 收到出牌事件: {playerId: "玩家1", playerName: "玩家1", cards: Array(2), cardType: {...}}
🎴 [出牌] 更新上家出牌: {type: "PAIR", value: 5, ...}
```

### 如果还是不工作

1. **检查Socket连接**
   - 打开浏览器控制台
   - 查看是否有Socket连接错误

2. **检查房间加入**
   - 后端日志应该显示：`✅ Socket xxx 已加入房间 room_A01`
   - 如果没有，说明玩家没有正确加入Socket房间

3. **检查事件监听**
   - 前端应该监听`cards_played`事件
   - 检查`room-simple.js`中是否有：`socket.on('cards_played', ...)`

## ⚠️ 常见问题

### Q: 修改代码后没有效果
A: TypeScript需要重新编译。停止服务器，删除dist文件夹，重新运行`npm run dev`

### Q: 玩家1看到了，但玩家2和3没看到
A: 检查Socket.IO房间广播是否正确。后端应该使用`io.to('room_${roomId}').emit(...)`

### Q: 控制台报错
A: 查看具体错误信息，可能是：
- Socket未连接
- 房间未加入
- 事件名称不匹配
- 数据格式错误
