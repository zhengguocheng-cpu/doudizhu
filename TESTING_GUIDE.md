# 🧪 测试指南 - 系统化测试流程

**项目**: 斗地主游戏 Web版  
**测试阶段**: 上线前全面测试  
**开始时间**: 2025-10-30

---

## 📋 **测试准备**

### **环境准备**
1. **启动后端服务器**
   ```bash
   cd backend
   npm start
   # 或
   node src/app.js
   ```
   确认输出: `Server running on port 3000`

2. **打开浏览器**
   - 主窗口: 测试用户A
   - 无痕窗口1: 测试用户B
   - 无痕窗口2: 测试用户C

3. **访问地址**
   ```
   http://localhost:3000
   ```

---

## 🎯 **阶段1: 核心功能测试**

### **1.1 用户认证流程测试**

#### **测试1.1.1: 登录功能**

**步骤**:
1. 打开 `http://localhost:3000`
2. 输入用户名: `测试玩家A`
3. 点击"进入游戏"

**检查点**:
- [ ] 用户名输入框可以输入
- [ ] 点击按钮后跳转到大厅
- [ ] URL变为 `/lobby/index.html?playerName=测试玩家A&playerAvatar=👑`
- [ ] localStorage保存了userId和userName

**期望结果**: ✅ 成功进入大厅

---

#### **测试1.1.2: 用户名验证**

**步骤**:
1. 尝试输入空用户名
2. 尝试输入特殊字符: `<script>alert(1)</script>`
3. 尝试输入超长用户名: `这是一个非常非常非常长的用户名超过50个字符...`

**检查点**:
- [ ] 空用户名有提示
- [ ] 特殊字符被过滤或拒绝
- [ ] 超长用户名被截断或拒绝

**期望结果**: ✅ 有合理的验证和提示

---

#### **测试1.1.3: 会话保持**

**步骤**:
1. 登录进入大厅
2. 刷新页面 (F5)
3. 关闭标签页，重新打开 `http://localhost:3000`

**检查点**:
- [ ] 刷新后仍在大厅页面
- [ ] 用户名仍然显示
- [ ] Socket连接自动恢复
- [ ] 连接状态显示"已连接"

**期望结果**: ✅ 会话保持，无需重新登录

---

#### **测试1.1.4: 登出功能**

**步骤**:
1. 在大厅点击"登出"按钮
2. 观察页面变化

**检查点**:
- [ ] 跳转回登录页面
- [ ] localStorage被清除
- [ ] Socket连接断开
- [ ] 无法访问大厅页面

**期望结果**: ✅ 成功登出，清除所有状态

---

### **1.2 大厅功能测试**

#### **测试1.2.1: 房间列表显示**

**步骤**:
1. 登录进入大厅
2. 观察房间列表

**检查点**:
- [ ] 显示所有房间
- [ ] 房间信息完整（名称、ID、玩家数）
- [ ] 状态标识正确（可加入/已满/游戏中）
- [ ] 颜色区分清晰

**期望结果**: ✅ 房间列表正确显示

---

#### **测试1.2.2: 房间状态标识**

**前置条件**: 创建3个房间，分别处于不同状态

**步骤**:
1. 房间A: 0/3玩家
2. 房间B: 3/3玩家（已满）
3. 房间C: 3/3玩家（游戏中）

**检查点**:
- [ ] 房间A显示"[可加入]"绿色徽章
- [ ] 房间B显示"[已满]"红色徽章，按钮禁用
- [ ] 房间C显示"[游戏中]"黄色徽章，按钮禁用
- [ ] 已满房间背景变灰
- [ ] 游戏中房间背景变黄

**期望结果**: ✅ 状态标识清晰准确

---

#### **测试1.2.3: 加入房间**

**步骤**:
1. 点击可加入房间的"加入房间"按钮
2. 观察页面跳转

**检查点**:
- [ ] 成功跳转到房间页面
- [ ] URL包含roomId参数
- [ ] 房间页面显示正确
- [ ] 玩家信息显示正确

**期望结果**: ✅ 成功加入房间

---

#### **测试1.2.4: 加入已满房间**

**步骤**:
1. 尝试点击已满房间的按钮

**检查点**:
- [ ] 按钮是禁用状态
- [ ] 无法点击
- [ ] 或点击后有友好提示

**期望结果**: ✅ 无法加入已满房间

---

#### **测试1.2.5: 创建房间**

**步骤**:
1. 点击"创建房间"按钮
2. 输入房间名称: `测试房间`
3. 点击确认

**检查点**:
- [ ] 房间创建成功
- [ ] 自动加入新房间
- [ ] 房间列表更新
- [ ] 其他玩家能看到新房间

**期望结果**: ✅ 成功创建并加入房间

---

#### **测试1.2.6: 刷新房间列表**

**步骤**:
1. 点击"刷新"按钮
2. 观察房间列表变化

**检查点**:
- [ ] 房间列表重新加载
- [ ] 显示最新状态
- [ ] 无重复房间
- [ ] 加载速度快

**期望结果**: ✅ 房间列表正确刷新

---

#### **测试1.2.7: 实时更新**

**步骤**:
1. 玩家A在大厅
2. 玩家B创建新房间
3. 玩家C加入房间

**检查点**:
- [ ] 玩家A自动看到新房间
- [ ] 房间人数实时更新
- [ ] 无需手动刷新

**期望结果**: ✅ 房间列表实时更新

---

### **1.3 房间功能测试**

#### **测试1.3.1: 进入房间显示**

**步骤**:
1. 玩家A加入房间
2. 观察房间页面

**检查点**:
- [ ] 显示房间名称和ID
- [ ] 显示当前玩家（自己）
- [ ] 头像和名称正确
- [ ] 连接状态显示"已连接"
- [ ] 显示"开始游戏"按钮

**期望结果**: ✅ 房间信息正确显示

---

#### **测试1.3.2: 多人加入**

**步骤**:
1. 玩家A在房间中
2. 玩家B加入同一房间
3. 玩家C加入同一房间

**检查点**:
- [ ] 玩家A看到玩家B加入的消息
- [ ] 玩家A看到玩家C加入的消息
- [ ] 所有玩家都能看到3个玩家
- [ ] 玩家位置正确（自己在底部）
- [ ] 头像和名称都正确

**期望结果**: ✅ 多人加入显示正确

---

#### **测试1.3.3: 准备机制**

**步骤**:
1. 玩家A点击"开始游戏"
2. 观察按钮和消息变化

**检查点**:
- [ ] 按钮文字变为"取消准备"
- [ ] 按钮颜色变化
- [ ] 显示消息"✅ 玩家A 已准备"
- [ ] 其他玩家看到准备消息
- [ ] 玩家A的状态显示"已准备"

**期望结果**: ✅ 准备状态正确

---

#### **测试1.3.4: 取消准备**

**步骤**:
1. 玩家A已准备
2. 点击"取消准备"

**检查点**:
- [ ] 按钮文字变回"开始游戏"
- [ ] 显示消息"⏳ 玩家A 取消准备"
- [ ] 其他玩家看到取消准备消息
- [ ] 玩家A的状态显示"未准备"

**期望结果**: ✅ 取消准备正确

---

#### **测试1.3.5: 全员准备自动开始**

**步骤**:
1. 3个玩家都在房间中
2. 玩家A点击"开始游戏"
3. 玩家B点击"开始游戏"
4. 玩家C点击"开始游戏"

**检查点**:
- [ ] 第3个玩家准备后自动开始游戏
- [ ] 显示"游戏开始"消息
- [ ] 开始发牌
- [ ] 准备按钮消失或禁用

**期望结果**: ✅ 全员准备后自动开始

---

#### **测试1.3.6: 聊天功能**

**步骤**:
1. 玩家A输入消息: `大家好！`
2. 点击发送

**检查点**:
- [ ] 消息显示在聊天区
- [ ] 显示时间、玩家名、消息内容
- [ ] 其他玩家能看到消息
- [ ] 聊天区自动滚动到底部
- [ ] 字体大小合适（15px）

**期望结果**: ✅ 聊天功能正常

---

#### **测试1.3.7: 离开房间**

**步骤**:
1. 玩家A在房间中
2. 点击"返回大厅"

**检查点**:
- [ ] 成功返回大厅
- [ ] 其他玩家看到"玩家A 离开了房间"
- [ ] 房间人数减少
- [ ] 大厅房间列表更新

**期望结果**: ✅ 成功离开房间

---

### **1.4 游戏流程测试**

#### **测试1.4.1: 发牌**

**步骤**:
1. 3个玩家全部准备
2. 观察发牌过程

**检查点**:
- [ ] 显示发牌动画
- [ ] 每个玩家收到17张牌
- [ ] 底牌3张
- [ ] 手牌按大小排序
- [ ] 手牌显示清晰

**期望结果**: ✅ 发牌正确

---

#### **测试1.4.2: 叫地主流程**

**步骤**:
1. 发牌完成
2. 按顺序叫地主

**检查点**:
- [ ] 轮到的玩家可以操作
- [ ] 显示"叫地主"和"不叫"按钮
- [ ] 其他玩家等待
- [ ] 叫地主后显示消息
- [ ] 地主确定后显示地主标识

**期望结果**: ✅ 叫地主流程正确

---

#### **测试1.4.3: 底牌分配**

**步骤**:
1. 地主确定
2. 观察底牌分配

**检查点**:
- [ ] 底牌显示给所有玩家
- [ ] 地主获得底牌
- [ ] 地主手牌变为20张
- [ ] 底牌加入地主手牌后重新排序

**期望结果**: ✅ 底牌分配正确

---

#### **测试1.4.4: 出牌 - 单张**

**步骤**:
1. 地主先出牌
2. 选择一张牌
3. 点击"出牌"

**检查点**:
- [ ] 牌可以选择（高亮）
- [ ] 出牌成功
- [ ] 牌显示在出牌区
- [ ] 手牌数量减少
- [ ] 其他玩家看到出牌

**期望结果**: ✅ 单张出牌正确

---

#### **测试1.4.5: 出牌 - 对子**

**步骤**:
1. 选择两张相同点数的牌
2. 点击"出牌"

**检查点**:
- [ ] 对子验证通过
- [ ] 出牌成功
- [ ] 显示正确

**期望结果**: ✅ 对子出牌正确

---

#### **测试1.4.6: 出牌 - 顺子**

**步骤**:
1. 选择5张连续的牌（如3-4-5-6-7）
2. 点击"出牌"

**检查点**:
- [ ] 顺子验证通过
- [ ] 出牌成功
- [ ] 显示正确

**期望结果**: ✅ 顺子出牌正确

---

#### **测试1.4.7: 出牌 - 炸弹**

**步骤**:
1. 选择4张相同点数的牌
2. 点击"出牌"

**检查点**:
- [ ] 炸弹验证通过
- [ ] 出牌成功
- [ ] 有特殊效果或提示

**期望结果**: ✅ 炸弹出牌正确

---

#### **测试1.4.8: 出牌 - 王炸**

**步骤**:
1. 选择小王和大王
2. 点击"出牌"

**检查点**:
- [ ] 王炸验证通过
- [ ] 出牌成功
- [ ] 有特殊效果

**期望结果**: ✅ 王炸出牌正确

---

#### **测试1.4.9: 出牌 - 非法牌型**

**步骤**:
1. 随机选择几张不构成牌型的牌
2. 点击"出牌"

**检查点**:
- [ ] 提示"不是有效的牌型"
- [ ] 出牌失败
- [ ] 牌仍在手中

**期望结果**: ✅ 非法牌型被拒绝

---

#### **测试1.4.10: 过牌**

**步骤**:
1. 轮到玩家出牌
2. 点击"不出"

**检查点**:
- [ ] 显示"玩家X 不出"消息
- [ ] 轮到下一个玩家
- [ ] 其他玩家看到消息

**期望结果**: ✅ 过牌正确

---

#### **测试1.4.11: 提示功能**

**步骤**:
1. 上家出了一张5
2. 点击"提示"按钮

**检查点**:
- [ ] 显示可以出的牌（6、7、8...或炸弹）
- [ ] 提示准确
- [ ] 可以选择提示的牌出牌

**期望结果**: ✅ 提示功能正确

---

#### **测试1.4.12: 游戏结束 - 地主赢**

**步骤**:
1. 地主先出完所有牌

**检查点**:
- [ ] 游戏结束
- [ ] 显示结算页面
- [ ] 显示"地主胜利"
- [ ] 积分计算正确
- [ ] 显示所有玩家的积分变化

**期望结果**: ✅ 地主赢结算正确

---

#### **测试1.4.13: 游戏结束 - 农民赢**

**步骤**:
1. 任一农民先出完所有牌

**检查点**:
- [ ] 游戏结束
- [ ] 显示结算页面
- [ ] 显示"农民胜利"
- [ ] 积分计算正确
- [ ] 两个农民都加分，地主扣分

**期望结果**: ✅ 农民赢结算正确

---

#### **测试1.4.14: 春天/反春天**

**步骤**:
1. 地主一轮出完（春天）
2. 或农民一轮出完（反春天）

**检查点**:
- [ ] 识别春天/反春天
- [ ] 积分翻倍
- [ ] 显示特殊提示

**期望结果**: ✅ 春天判定正确

---

#### **测试1.4.15: 再来一局**

**步骤**:
1. 游戏结束后
2. 点击"再来一局"

**检查点**:
- [ ] 返回房间
- [ ] 自动准备
- [ ] 等待其他玩家准备
- [ ] 可以开始新游戏

**期望结果**: ✅ 再来一局功能正常

---

### **1.5 个人中心测试**

#### **测试1.5.1: 页面显示**

**步骤**:
1. 在大厅点击"个人中心"
2. 观察页面内容

**检查点**:
- [ ] 显示用户名
- [ ] 显示头像
- [ ] 显示总场次
- [ ] 显示胜场
- [ ] 显示胜率
- [ ] 显示积分

**期望结果**: ✅ 个人信息正确显示

---

#### **测试1.5.2: 战绩历史**

**步骤**:
1. 查看战绩历史列表

**检查点**:
- [ ] 显示最近的游戏记录
- [ ] 显示时间、对手、结果
- [ ] 数据准确
- [ ] 按时间倒序排列

**期望结果**: ✅ 战绩历史正确

---

#### **测试1.5.3: 数据准确性**

**步骤**:
1. 玩一局游戏
2. 返回个人中心
3. 检查数据是否更新

**检查点**:
- [ ] 总场次+1
- [ ] 胜场正确更新
- [ ] 胜率重新计算
- [ ] 积分变化正确

**期望结果**: ✅ 数据实时更新

---

#### **测试1.5.4: 返回大厅**

**步骤**:
1. 点击"返回大厅"

**检查点**:
- [ ] 成功返回大厅
- [ ] 不是返回登录页

**期望结果**: ✅ 导航正确

---

### **1.6 排行榜测试**

#### **测试1.6.1: 页面显示**

**步骤**:
1. 在大厅点击"排行榜"
2. 观察页面内容

**检查点**:
- [ ] 显示所有玩家
- [ ] 显示排名、用户名、积分/胜率
- [ ] 数据按积分降序排列
- [ ] 页面布局美观

**期望结果**: ✅ 排行榜正确显示

---

#### **测试1.6.2: 积分排行**

**步骤**:
1. 查看积分排行榜

**检查点**:
- [ ] 按积分从高到低排序
- [ ] 显示积分数值
- [ ] 排名正确

**期望结果**: ✅ 积分排行正确

---

#### **测试1.6.3: 胜率排行**

**步骤**:
1. 点击"胜率排行"标签
2. 观察排序变化

**检查点**:
- [ ] 按胜率从高到低排序
- [ ] 显示胜率百分比
- [ ] 排名正确
- [ ] 标签样式切换

**期望结果**: ✅ 胜率排行正确

---

#### **测试1.6.4: 我的排名高亮**

**步骤**:
1. 在排行榜中找到自己

**检查点**:
- [ ] 自己的排名有高亮
- [ ] 有👤图标标识
- [ ] 容易识别

**期望结果**: ✅ 我的排名突出显示

---

#### **测试1.6.5: 返回大厅**

**步骤**:
1. 点击"返回大厅"

**检查点**:
- [ ] 成功返回大厅

**期望结果**: ✅ 导航正确

---

## 📝 **测试记录表**

### **阶段1完成度**

| 模块 | 测试项 | 通过 | 失败 | 完成率 |
|------|--------|------|------|--------|
| 1.1 用户认证 | 4 | 0 | 0 | 0% |
| 1.2 大厅功能 | 7 | 0 | 0 | 0% |
| 1.3 房间功能 | 7 | 0 | 0 | 0% |
| 1.4 游戏流程 | 15 | 0 | 0 | 0% |
| 1.5 个人中心 | 4 | 0 | 0 | 0% |
| 1.6 排行榜 | 5 | 0 | 0 | 0% |
| **总计** | **42** | **0** | **0** | **0%** |

---

## 🐛 **发现的问题**

### **Bug列表**
1. ✅ Bug #1: 大厅连接状态显示错误 - 已修复

---

## 📋 **下一步**

完成阶段1测试后，继续：
- 阶段2: 异常情况测试
- 阶段3: 用户体验优化
- Bug修复和优化
- 最终检查

---

**开始测试吧！发现问题随时记录！** 🚀
