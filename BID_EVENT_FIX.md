# æŠ¢åœ°ä¸»äº‹ä»¶ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- 3ä¸ªç©å®¶éƒ½é€‰æ‹©æŠ¢åœ°ä¸»
- å‰ç«¯æ²¡æœ‰æ˜¾ç¤ºé¢„æœŸæ—¥å¿—
- åç«¯æ²¡æœ‰æ˜¾ç¤º"ç¡®å®šåœ°ä¸»"æ—¥å¿—
- åœ°ä¸»æ²¡æœ‰ç¡®å®š

**æ ¹æœ¬åŸå› **ï¼š
å‰åç«¯äº‹ä»¶åç§°ä¸åŒ¹é…ï¼

```
å‰ç«¯å‘é€: socket.emit('bid', {...})
åç«¯ç›‘å¬: socket.on('bid_landlord', ...)  âŒ ä¸åŒ¹é…ï¼
```

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶
`backend/src/app.ts`

### ä¿®æ”¹å†…å®¹
```typescript
// ä¿®æ”¹å‰
socket.on('bid_landlord', (data: any) => {
    this.eventHandler.handleBidLandlord(socket, data);
});

// ä¿®æ”¹å
socket.on('bid', (data: any) => {
    console.log('ğŸ² [Socket] æ”¶åˆ°bidäº‹ä»¶:', data);
    this.eventHandler.handleBidLandlord(socket, data);
});
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. ç¡®è®¤åç«¯é‡å¯
åç«¯ä½¿ç”¨nodemonï¼Œåº”è¯¥è‡ªåŠ¨é‡å¯ã€‚æŸ¥çœ‹åç«¯ç»ˆç«¯ï¼š
```
[nodemon] restarting due to changes...
[nodemon] starting `ts-node src/server.ts`
```

### 2. åˆ·æ–°æ‰€æœ‰æµè§ˆå™¨çª—å£
- å…³é—­æ‰€æœ‰æˆ¿é—´é¡µé¢
- é‡æ–°ä»å¤§å…åŠ å…¥æˆ¿é—´

### 3. é‡æ–°æµ‹è¯•æŠ¢åœ°ä¸»
1. 3ä¸ªç©å®¶åŠ å…¥æˆ¿é—´
2. æ‰€æœ‰äººç‚¹å‡»"å¼€å§‹æ¸¸æˆ"
3. ç­‰å¾…å‘ç‰ŒåŠ¨ç”»å®Œæˆ
4. ç¬¬ä¸€ä¸ªç©å®¶ç‚¹å‡»"æŠ¢åœ°ä¸»"
5. ç¬¬äºŒä¸ªç©å®¶ç‚¹å‡»"æŠ¢åœ°ä¸»"
6. ç¬¬ä¸‰ä¸ªç©å®¶ç‚¹å‡»"æŠ¢åœ°ä¸»"

### 4. é¢„æœŸæ—¥å¿—

**åç«¯æ—¥å¿—**ï¼š
```
ğŸ² [Socket] æ”¶åˆ°bidäº‹ä»¶: { roomId: 'A01', userId: 'player1', bid: true }
ğŸ² ç©å®¶player1æŠ¢åœ°ä¸»: æŠ¢
ğŸ² [Socket] æ”¶åˆ°bidäº‹ä»¶: { roomId: 'A01', userId: 'player2', bid: true }
ğŸ² ç©å®¶player2æŠ¢åœ°ä¸»: æŠ¢
ğŸ² [Socket] æ”¶åˆ°bidäº‹ä»¶: { roomId: 'A01', userId: 'player3', bid: true }
ğŸ² ç©å®¶player3æŠ¢åœ°ä¸»: æŠ¢
ğŸ‘‘ ç¡®å®šåœ°ä¸»: player3
ğŸ“¢ å‘æˆ¿é—´ room_A01 å¹¿æ’­åœ°ä¸»ç¡®å®šäº‹ä»¶
âœ… åœ°ä¸»ç¡®å®šäº‹ä»¶å·²å¹¿æ’­: player3 æˆä¸ºåœ°ä¸»ï¼Œæ‰‹ç‰Œ20å¼ 
```

**å‰ç«¯æ—¥å¿—ï¼ˆåœ°ä¸»ï¼‰**ï¼š
```
é€‰æ‹©æŠ¢åœ°ä¸»: true
ğŸ¯ [åœ°ä¸»ç¡®å®š] æ”¶åˆ°æ•°æ®: {...}
âœ… æˆ‘æ˜¯åœ°ä¸»ï¼Œæ›´æ–°æ‰‹ç‰Œ
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] å¼€å§‹æ˜¾ç¤ºåº•ç‰Œ: [...]
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] æ˜¾ç¤ºç¬¬1å¼ åº•ç‰Œ: â™ A
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] æ˜¾ç¤ºç¬¬2å¼ åº•ç‰Œ: â™¥K
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] æ˜¾ç¤ºç¬¬3å¼ åº•ç‰Œ: â™¦Q
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] åº•ç‰ŒåŠ¨ç”»å®Œæˆ
ğŸ‘‘ [è§’è‰²æ ‡è®°] æ›´æ–°ç©å®¶è§’è‰²: {...}
```

**å‰ç«¯æ—¥å¿—ï¼ˆå†œæ°‘ï¼‰**ï¼š
```
é€‰æ‹©æŠ¢åœ°ä¸»: true
ğŸ¯ [åœ°ä¸»ç¡®å®š] æ”¶åˆ°æ•°æ®: {...}
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] å¼€å§‹æ˜¾ç¤ºåº•ç‰Œ: [...]
ğŸ´ [åº•ç‰ŒåŠ¨ç”»] åº•ç‰ŒåŠ¨ç”»å®Œæˆ
ğŸ‘‘ [è§’è‰²æ ‡è®°] æ›´æ–°ç©å®¶è§’è‰²: {...}
```

### 5. é¢„æœŸæ•ˆæœ
- âœ… èŠå¤©æ¡†æ˜¾ç¤º"XXX æˆä¸ºåœ°ä¸»ï¼"
- âœ… æ¡Œé¢ä¸­å¤®æ˜¾ç¤º3å¼ åº•ç‰Œï¼ˆåœç•™1.5ç§’ï¼‰
- âœ… åœ°ä¸»ç©å®¶åå­—æ—æ˜¾ç¤ºğŸ‘‘æ ‡è®°
- âœ… åœ°ä¸»ç©å®¶æ‰‹ç‰Œæ›´æ–°ä¸º20å¼ 
- âœ… å…¶ä»–ç©å®¶ä»ç„¶æ˜¯17å¼ ç‰Œ

---

## ğŸ” è°ƒè¯•æŠ€å·§

### å¦‚æœåç«¯æ²¡æœ‰æ”¶åˆ°äº‹ä»¶
1. æ£€æŸ¥å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. æ£€æŸ¥Socketè¿æ¥çŠ¶æ€
3. åœ¨å‰ç«¯æ·»åŠ æ—¥å¿—ï¼š
```javascript
handleBid(bid) {
    console.log('ğŸ² [å‰ç«¯] å‘é€bidäº‹ä»¶:', {
        roomId: this.currentRoom.id,
        userId: this.currentPlayerId,
        bid: bid
    });
    this.socket.emit('bid', {...});
}
```

### å¦‚æœåç«¯æ”¶åˆ°äº‹ä»¶ä½†æ²¡æœ‰å¤„ç†
1. æ£€æŸ¥ `handleBidLandlord` æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨
2. æ£€æŸ¥æˆ¿é—´æ•°æ®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥ `biddingState` æ˜¯å¦å­˜åœ¨

### æ‰‹åŠ¨è§¦å‘äº‹ä»¶ï¼ˆæµ‹è¯•ç”¨ï¼‰
åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼š
```javascript
window.roomClient.socket.emit('bid', {
    roomId: 'A01',
    userId: 'player1',
    bid: true
});
```

---

## ğŸ“Š äº‹ä»¶æµç¨‹

```
å‰ç«¯                                    åç«¯
â”‚                                       â”‚
â”œâ”€ ç”¨æˆ·ç‚¹å‡»"æŠ¢åœ°ä¸»"                     â”‚
â”œâ”€ handleBid(true)                      â”‚
â”œâ”€ console.log('é€‰æ‹©æŠ¢åœ°ä¸»: true')      â”‚
â”œâ”€ socket.emit('bid', {                 â”‚
â”‚     roomId: 'A01',                    â”‚
â”‚     userId: 'player1',                â”‚
â”‚     bid: true                         â”‚
â”‚   }) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
â”‚                                       â”œâ”€ socket.on('bid') è§¦å‘ âœ…
â”‚                                       â”œâ”€ console.log('ğŸ² [Socket] æ”¶åˆ°bidäº‹ä»¶')
â”‚                                       â”œâ”€ handleBidLandlord()
â”‚                                       â”œâ”€ console.log('ğŸ² ç©å®¶player1æŠ¢åœ°ä¸»: æŠ¢')
â”‚                                       â”œâ”€ è®°å½•é€‰æ‹©
â”‚                                       â”œâ”€ æ£€æŸ¥æ˜¯å¦3äººéƒ½é€‰æ‹©
â”‚                                       â”œâ”€ determineLandlord()
â”‚                                       â”œâ”€ console.log('ğŸ‘‘ ç¡®å®šåœ°ä¸»: player3')
â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”œâ”€ io.to(room).emit('landlord_determined')
â”œâ”€ onLandlordDetermined()               â”‚
â”œâ”€ console.log('ğŸ¯ [åœ°ä¸»ç¡®å®š] æ”¶åˆ°æ•°æ®') â”‚
â””â”€ æ˜¾ç¤ºåº•ç‰ŒåŠ¨ç”» + æ›´æ–°æ‰‹ç‰Œ              â”‚
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. äº‹ä»¶åç§°å¿…é¡»å®Œå…¨åŒ¹é…
```
å‰ç«¯: socket.emit('bid')
åç«¯: socket.on('bid')  âœ… åŒ¹é…

å‰ç«¯: socket.emit('bid')
åç«¯: socket.on('bid_landlord')  âŒ ä¸åŒ¹é…
```

### 2. æ•°æ®ç»“æ„å¿…é¡»ä¸€è‡´
```javascript
// å‰ç«¯å‘é€
{
    roomId: string,
    userId: string,
    bid: boolean
}

// åç«¯æ¥æ”¶
const { roomId, userId, bid } = data;
```

### 3. åç«¯å¿…é¡»é‡å¯
- ä½¿ç”¨nodemonä¼šè‡ªåŠ¨é‡å¯
- æ‰‹åŠ¨å¯åŠ¨éœ€è¦é‡å¯æœåŠ¡å™¨

### 4. å‰ç«¯å¿…é¡»åˆ·æ–°
- æ¸…é™¤ç¼“å­˜ï¼ˆCtrl + Shift + Rï¼‰
- æˆ–å…³é—­é¡µé¢é‡æ–°æ‰“å¼€

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### åç«¯
- `backend/src/app.ts` - Socketäº‹ä»¶ç›‘å¬ï¼ˆå·²ä¿®å¤ï¼‰
- `backend/src/services/socket/SocketEventHandler.ts` - äº‹ä»¶å¤„ç†å™¨
- `backend/src/services/socket/GameFlowHandler.ts` - æ¸¸æˆæµç¨‹å¤„ç†

### å‰ç«¯
- `frontend/public/room/js/room-simple.js` - æˆ¿é—´é€»è¾‘
  - `handleBid()` - å‘é€bidäº‹ä»¶
  - `onLandlordDetermined()` - å¤„ç†åœ°ä¸»ç¡®å®š

---

**ä¿®å¤æ—¶é—´**: 2025-10-27 07:31
**é—®é¢˜ç±»å‹**: äº‹ä»¶åç§°ä¸åŒ¹é…
**ä¿®å¤çŠ¶æ€**: âœ… å·²ä¿®å¤ï¼Œå¾…æµ‹è¯•éªŒè¯
