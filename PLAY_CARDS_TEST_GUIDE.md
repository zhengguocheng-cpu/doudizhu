# 出牌功能测试指南

## 📋 测试目标

测试完整的出牌流程，包括：
1. 出牌验证功能
2. 上家出牌显示
3. 牌型识别
4. 不出功能

---

## 🚀 测试准备

### 1. 启动后端服务器
```bash
cd backend
npm run dev
```

### 2. 打开3个浏览器窗口

**窗口1 - 玩家1**:
```
http://localhost:3000/room/room.html?roomId=TEST01&playerName=玩家1&playerAvatar=%F0%9F%8E%AE&joined=true
```

**窗口2 - 玩家2**:
```
http://localhost:3000/room/room.html?roomId=TEST01&playerName=玩家2&playerAvatar=%F0%9F%8E%B2&joined=true
```

**窗口3 - 玩家3**:
```
http://localhost:3000/room/room.html?roomId=TEST01&playerName=玩家3&playerAvatar=%F0%9F%8E%AF&joined=true
```

---

## 🧪 测试步骤

### Step 1: 开始游戏
- [ ] 3个玩家都点击"开始游戏"
- [ ] 等待发牌动画
- [ ] 检查每个玩家都收到17张牌

### Step 2: 抢地主
- [ ] 3个玩家依次选择"抢地主"或"不抢"
- [ ] 确定地主后，检查：
  - [ ] 地主有金色边框和👑徽章
  - [ ] 桌面顶端显示3张底牌
  - [ ] 地主手牌增加到20张

### Step 3: 测试出牌验证

#### 3.1 首次出牌（地主）
- [ ] 地主选择1张牌，点击"出牌"
  - 预期：✅ 出牌成功，显示"出牌：单牌"
- [ ] 地主选择2张相同的牌，点击"出牌"
  - 预期：✅ 出牌成功，显示"出牌：对子"
- [ ] 地主选择3张不同的牌，点击"出牌"
  - 预期：❌ 出牌失败，显示"无效的牌型"

#### 3.2 跟牌测试
假设地主出了单牌3：
- [ ] 下家选择单牌4，点击"出牌"
  - 预期：✅ 出牌成功
- [ ] 下家选择单牌2（比3小），点击"出牌"
  - 预期：❌ 出牌失败，显示"牌太小，压不过"
- [ ] 下家选择对子44，点击"出牌"
  - 预期：❌ 出牌失败，显示"牌型不匹配"

#### 3.3 炸弹测试
假设上家出了单牌A：
- [ ] 当前玩家选择4张相同的牌（炸弹），点击"出牌"
  - 预期：✅ 出牌成功，显示"出牌：炸弹"

#### 3.4 王炸测试
- [ ] 当前玩家选择大王+小王，点击"出牌"
  - 预期：✅ 出牌成功，显示"出牌：王炸"

### Step 4: 测试不出功能
- [ ] 当前玩家点击"不出"
  - 预期：显示"选择不出牌"
- [ ] 所有玩家都不出后
  - 预期：显示"所有人都不出，可以出任意牌型"

### Step 5: 测试上家出牌显示
- [ ] 玩家1出牌后，检查玩家2和玩家3的界面
  - [ ] 桌面中央显示"玩家1 出牌：单牌"
  - [ ] 显示玩家1出的牌
- [ ] 玩家2出牌后，检查所有玩家界面
  - [ ] 上家出牌区域更新为玩家2的牌

### Step 6: 测试底牌隐藏
- [ ] 地主确定后，3张底牌显示在桌面顶端
- [ ] 第一个玩家出牌后
  - [ ] 底牌自动隐藏

---

## ✅ 验证要点

### 前端验证
1. **牌型识别**
   - [ ] 单牌、对子、三张正确识别
   - [ ] 顺子、连对、飞机正确识别
   - [ ] 炸弹、王炸正确识别

2. **出牌验证**
   - [ ] 无效牌型被拒绝
   - [ ] 压不过上家被拒绝
   - [ ] 牌型不匹配被拒绝
   - [ ] 首次出牌任意牌型通过

3. **UI显示**
   - [ ] 出牌成功/失败有明确提示
   - [ ] 上家出牌在桌面中央显示
   - [ ] 牌型描述正确显示
   - [ ] 底牌显示和隐藏正常

### 后端验证
1. **事件处理**
   - [ ] play_cards事件正确处理
   - [ ] cards_played事件正确广播
   - [ ] player_passed事件正确处理

2. **状态管理**
   - [ ] 上家出牌信息正确保存
   - [ ] 轮次切换正常
   - [ ] 游戏状态正确更新

---

## 🐛 已知问题

### 需要修复的后端逻辑
1. **出牌事件处理**
   - 后端需要接收和处理cardType
   - 后端需要验证出牌合法性
   - 后端需要广播cardType给所有玩家

2. **轮次管理**
   - 后端需要正确切换玩家轮次
   - 后端需要处理所有人pass的情况

---

## 📝 测试记录

### 测试日期：____________________

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 牌型识别 | ⬜ 通过 ⬜ 失败 | |
| 出牌验证 | ⬜ 通过 ⬜ 失败 | |
| 上家出牌显示 | ⬜ 通过 ⬜ 失败 | |
| 不出功能 | ⬜ 通过 ⬜ 失败 | |
| 底牌隐藏 | ⬜ 通过 ⬜ 失败 | |

### 发现的问题：
1. 
2. 
3. 

---

## 🎯 下一步计划

完成测试后：
1. 修复发现的问题
2. 优化用户体验
3. 添加出牌提示功能
4. 实现游戏结算
