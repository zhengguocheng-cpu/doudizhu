# F5åˆ·æ–°æµç¨‹åˆ†æž

## ðŸ“Š **åœºæ™¯ï¼šçŽ©å®¶Aåœ¨æˆ¿é—´é¡µé¢æŒ‰F5åˆ·æ–°**

### **åˆå§‹çŠ¶æ€**
```
- çŽ©å®¶Aåœ¨æˆ¿é—´A05ä¸­
- æˆ¿é—´çŠ¶æ€: 1/3 çŽ©å®¶
- Socketè¿žæŽ¥: æ­£å¸¸
- é¡µé¢: /room/room.html?roomId=A05&playerName=çŽ©å®¶A&playerAvatar=ðŸŽ²
```

---

## ðŸ”„ **å®Œæ•´æµç¨‹å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŽ©å®¶AæŒ‰F5åˆ·æ–°                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1. æµè§ˆå™¨å¼€å§‹åˆ·æ–°
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨è¡Œä¸º                                                       â”‚
â”‚  â”œâ”€ æ–­å¼€å½“å‰é¡µé¢çš„æ‰€æœ‰è¿žæŽ¥ï¼ˆåŒ…æ‹¬Socketï¼‰                         â”‚
â”‚  â”œâ”€ æ¸…ç©ºå½“å‰é¡µé¢çš„JavaScriptè¿è¡ŒçŽ¯å¢ƒ                            â”‚
â”‚  â””â”€ é‡æ–°åŠ è½½é¡µé¢                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 2. Socketæ–­å¼€
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŽç«¯ AuthMiddleware.handleDisconnection()                       â”‚
â”‚  â”œâ”€ Socket disconnected: çŽ©å®¶A                                   â”‚
â”‚  â”œâ”€ User set offline: çŽ©å®¶A                                      â”‚
â”‚  â”œâ”€ Session set offline                                         â”‚
â”‚  â””â”€ å‘å¸ƒäº‹ä»¶: user:disconnected                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 3. æ¸…ç†æˆ¿é—´çŠ¶æ€
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŽç«¯ setupDisconnectionHandler()                                â”‚
â”‚  â”œâ”€ ðŸ”„ [æ¸…ç†] ç”¨æˆ·æ–­å¼€è¿žæŽ¥ï¼Œæ¸…ç†æˆ¿é—´çŠ¶æ€: çŽ©å®¶A                  â”‚
â”‚  â”œâ”€ éåŽ†æ‰€æœ‰æˆ¿é—´ï¼Œæ‰¾åˆ°çŽ©å®¶Aåœ¨æˆ¿é—´A05ä¸­                           â”‚
â”‚  â”œâ”€ ä»Žæˆ¿é—´A05ç§»é™¤çŽ©å®¶A                                           â”‚
â”‚  â”‚   â””â”€ roomService.leaveRoom('A05', 'çŽ©å®¶A')                   â”‚
â”‚  â”œâ”€ æˆ¿é—´çŠ¶æ€æ›´æ–°: 1/3 â†’ 0/3                                     â”‚
â”‚  â””â”€ é€šçŸ¥æˆ¿é—´å†…å…¶ä»–çŽ©å®¶ï¼ˆå¦‚æžœæœ‰ï¼‰                                 â”‚
â”‚      â””â”€ emit('player_left', { playerId: 'çŽ©å®¶A', ... })         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 4. é¡µé¢é‡æ–°åŠ è½½
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨é‡æ–°åŠ è½½ /room/room.html?roomId=A05&...                   â”‚
â”‚  â”œâ”€ åŠ è½½HTML                                                     â”‚
â”‚  â”œâ”€ åŠ è½½CSS                                                      â”‚
â”‚  â”œâ”€ åŠ è½½JavaScript (room-simple.js)                             â”‚
â”‚  â””â”€ æ‰§è¡Œé¡µé¢åˆå§‹åŒ–                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 5. æˆ¿é—´é¡µé¢åˆå§‹åŒ–
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoomSimple.constructor()                                        â”‚
â”‚  â”œâ”€ ä»ŽURLå‚æ•°èŽ·å–: roomId=A05, playerName=çŽ©å®¶A                 â”‚
â”‚  â”œâ”€ ä»ŽlocalStorageæ¢å¤: userId=çŽ©å®¶A, userName=çŽ©å®¶A            â”‚
â”‚  â””â”€ è°ƒç”¨ this.connectToServer()                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 6. å»ºç«‹æ–°Socketè¿žæŽ¥
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoomSimple.connectToServer()                                    â”‚
â”‚  â”œâ”€ this.socket = this.socketManager.connect()                  â”‚
â”‚  â”œâ”€ ç”Ÿæˆæ–°çš„ pageNavigationToken                                â”‚
â”‚  â””â”€ Socketè¿žæŽ¥åˆ°åŽç«¯                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 7. åŽç«¯è®¤è¯æ–°Socket
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŽç«¯è®¤è¯æµç¨‹                                                     â”‚
â”‚  â”œâ”€ ç”¨æˆ·è¿žæŽ¥: [æ–°socketId]                                      â”‚
â”‚  â”œâ”€ Processing auth from connection                             â”‚
â”‚  â”œâ”€ æ£€æµ‹åˆ° pageNavigationToken                                  â”‚
â”‚  â”œâ”€ UserManager.authenticateUser()                              â”‚
â”‚  â”‚   â””â”€ âœ… [MPA] æ£€æµ‹åˆ°é¡µé¢è·³è½¬ä»¤ç‰Œï¼Œå…è®¸æ–°è¿žæŽ¥                 â”‚
â”‚  â””â”€ User authenticated                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 8. Socketè¿žæŽ¥æˆåŠŸ
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoomSimple - socket.on('connect')                               â”‚
â”‚  â”œâ”€ âœ… [æˆ¿é—´] Socketè¿žæŽ¥æˆåŠŸ                                    â”‚
â”‚  â”œâ”€ updateConnectionStatus(true)                                â”‚
â”‚  â””â”€ ðŸ”„ [æˆ¿é—´] å‘é€join_gameè¯·æ±‚ï¼ŒåŠ å…¥æˆ¿é—´: A05                  â”‚
â”‚      â””â”€ this.joinRoom()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 9. é‡æ–°åŠ å…¥æˆ¿é—´
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŽç«¯ SocketEventHandler.handleJoinGame()                        â”‚
â”‚  â”œâ”€ ðŸ”„ æ”¶åˆ°join_gameè¯·æ±‚                                        â”‚
â”‚  â”œâ”€ roomId: A05, userId: çŽ©å®¶A                                  â”‚
â”‚  â”œâ”€ æ£€æŸ¥æˆ¿é—´çŠ¶æ€: 0/3 (å¯åŠ å…¥) âœ…                               â”‚
â”‚  â”œâ”€ çŽ©å®¶åŠ å…¥æ¸¸æˆ: A05 çŽ©å®¶A                                      â”‚
â”‚  â”œâ”€ æˆ¿é—´çŠ¶æ€æ›´æ–°: 0/3 â†’ 1/3                                     â”‚
â”‚  â”œâ”€ SocketåŠ å…¥Socket.IOæˆ¿é—´: room_A05                           â”‚
â”‚  â””â”€ å‘é€ join_game_success äº‹ä»¶                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 10. å‰ç«¯æ˜¾ç¤ºæˆ¿é—´
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RoomSimple.onJoinGameSuccess()                                  â”‚
â”‚  â”œâ”€ ðŸŽ‰ [Socketäº‹ä»¶] æ”¶åˆ° join_game_success                      â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯                                                 â”‚
â”‚  â”œâ”€ æ˜¾ç¤ºçŽ©å®¶åˆ—è¡¨: çŽ©å®¶A                                         â”‚
â”‚  â””â”€ æ˜¾ç¤º"å·²è¿žæŽ¥"çŠ¶æ€                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 11. å®Œæˆ
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ€ç»ˆçŠ¶æ€                                                         â”‚
â”‚  â”œâ”€ çŽ©å®¶Aé‡æ–°åœ¨æˆ¿é—´A05ä¸­                                        â”‚
â”‚  â”œâ”€ Socketè¿žæŽ¥æ­£å¸¸                                              â”‚
â”‚  â”œâ”€ æˆ¿é—´çŠ¶æ€: 1/3                                               â”‚
â”‚  â””â”€ é¡µé¢æ˜¾ç¤ºæ­£å¸¸                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ **æ—¶é—´çº¿åˆ†æž**

```
T0:   çŽ©å®¶AæŒ‰F5
T1:   æµè§ˆå™¨æ–­å¼€Socket
T2:   åŽç«¯æ”¶åˆ°disconnectäº‹ä»¶
T3:   åŽç«¯è®¾ç½®ç”¨æˆ·ç¦»çº¿
T4:   åŽç«¯å‘å¸ƒuser:disconnectedäº‹ä»¶
T5:   åŽç«¯ä»Žæˆ¿é—´A05ç§»é™¤çŽ©å®¶A (æˆ¿é—´: 1/3 â†’ 0/3)
T6:   æµè§ˆå™¨å¼€å§‹é‡æ–°åŠ è½½é¡µé¢
T7:   é¡µé¢åŠ è½½å®Œæˆï¼Œæ‰§è¡ŒJavaScript
T8:   å»ºç«‹æ–°Socketè¿žæŽ¥
T9:   åŽç«¯è®¤è¯æ–°Socketï¼ˆæ£€æµ‹åˆ°pageNavigationTokenï¼‰
T10:  Socketè¿žæŽ¥æˆåŠŸ
T11:  å‘é€join_gameè¯·æ±‚
T12:  åŽç«¯å¤„ç†ï¼ŒçŽ©å®¶Aé‡æ–°åŠ å…¥æˆ¿é—´ (æˆ¿é—´: 0/3 â†’ 1/3)
T13:  å‰ç«¯æ”¶åˆ°join_game_success
T14:  é¡µé¢æ˜¾ç¤ºæ­£å¸¸

æ€»è€—æ—¶: ~1-2ç§’
```

---

## âœ… **é¢„æœŸç»“æžœ**

### **æˆåŠŸåœºæ™¯ï¼ˆå½“å‰å®žçŽ°ï¼‰**
```
1. çŽ©å®¶Aè¢«ä»Žæˆ¿é—´ç§»é™¤ âœ…
2. é¡µé¢åˆ·æ–°åŽé‡æ–°åŠ è½½ âœ…
3. æ–°Socketè¿žæŽ¥å»ºç«‹ âœ…
4. çŽ©å®¶Aé‡æ–°åŠ å…¥æˆ¿é—´ âœ…
5. æˆ¿é—´çŠ¶æ€æ­£ç¡®: 1/3 âœ…
6. é¡µé¢æ˜¾ç¤ºæ­£å¸¸ âœ…
```

### **ç”¨æˆ·ä½“éªŒ**
- âœ… é¡µé¢åˆ·æ–°åŽè‡ªåŠ¨é‡æ–°åŠ å…¥æˆ¿é—´
- âœ… ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ
- âœ… æˆ¿é—´çŠ¶æ€æ­£ç¡®
- âœ… è¿žæŽ¥çŠ¶æ€æ­£å¸¸
- âš ï¸ çŸ­æš‚çš„"æœªè¿žæŽ¥"çŠ¶æ€ï¼ˆ1-2ç§’ï¼‰

---

## âš ï¸ **æ½œåœ¨é—®é¢˜**

### **é—®é¢˜1: æ¸¸æˆè¿›è¡Œä¸­åˆ·æ–°**

**åœºæ™¯**ï¼š
```
- æˆ¿é—´A05æœ‰3ä¸ªçŽ©å®¶ï¼šAã€Bã€C
- æ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­
- çŽ©å®¶AæŒ‰F5åˆ·æ–°
```

**ä¼šå‘ç”Ÿä»€ä¹ˆ**ï¼š
```
1. çŽ©å®¶Açš„Socketæ–­å¼€
2. åŽç«¯ä»Žæˆ¿é—´ç§»é™¤çŽ©å®¶A
3. æˆ¿é—´çŠ¶æ€: 3/3 â†’ 2/3
4. æ¸¸æˆå¯èƒ½ä¸­æ–­ï¼ˆå–å†³äºŽæ¸¸æˆé€»è¾‘ï¼‰
5. çŽ©å®¶Aåˆ·æ–°åŽé‡æ–°åŠ å…¥
6. ä½†æ¸¸æˆçŠ¶æ€å¯èƒ½å·²ç»ä¸¢å¤±
```

**é—®é¢˜**ï¼š
- âŒ æ¸¸æˆè¿›åº¦ä¸¢å¤±
- âŒ å…¶ä»–çŽ©å®¶å¯èƒ½çœ‹åˆ°çŽ©å®¶Aç¦»å¼€
- âŒ çŽ©å®¶Aé‡æ–°åŠ å…¥åŽï¼Œæ¸¸æˆçŠ¶æ€ä¸ä¸€è‡´

### **é—®é¢˜2: å¿«é€Ÿåˆ·æ–°**

**åœºæ™¯**ï¼š
```
- çŽ©å®¶Aåœ¨æˆ¿é—´ä¸­
- å¿«é€ŸæŒ‰å¤šæ¬¡F5
```

**ä¼šå‘ç”Ÿä»€ä¹ˆ**ï¼š
```
1. ç¬¬ä¸€æ¬¡F5: æ–­å¼€ â†’ ç§»é™¤ â†’ é‡è¿ž â†’ åŠ å…¥
2. ç¬¬äºŒæ¬¡F5ï¼ˆåœ¨é‡è¿žå®Œæˆå‰ï¼‰: æ–­å¼€ â†’ ç§»é™¤ â†’ ...
3. å¯èƒ½å‡ºçŽ°ç«žæ€æ¡ä»¶
```

**é—®é¢˜**ï¼š
- âš ï¸ å¯èƒ½å‡ºçŽ°çŸ­æš‚çš„çŠ¶æ€ä¸ä¸€è‡´
- âš ï¸ å¤šæ¬¡åŠ å…¥/ç¦»å¼€äº‹ä»¶

### **é—®é¢˜3: localStorageæ¸…ç©º**

**åœºæ™¯**ï¼š
```
- çŽ©å®¶Aåœ¨æˆ¿é—´ä¸­
- æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜ï¼ˆåŒ…æ‹¬localStorageï¼‰
- ç„¶åŽF5åˆ·æ–°
```

**ä¼šå‘ç”Ÿä»€ä¹ˆ**ï¼š
```
1. Socketæ–­å¼€ï¼ŒçŽ©å®¶è¢«ç§»é™¤
2. é¡µé¢åˆ·æ–°ï¼Œä½†localStorageä¸ºç©º
3. æ— æ³•ä»ŽlocalStorageæ¢å¤userId
4. è·³è½¬å›žç™»å½•é¡µ
```

**ç»“æžœ**ï¼š
- âœ… å®‰å…¨ï¼šå¼ºåˆ¶é‡æ–°ç™»å½•
- âš ï¸ ç”¨æˆ·ä½“éªŒï¼šéœ€è¦é‡æ–°ç™»å½•

---

## ðŸ”§ **æ”¹è¿›å»ºè®®**

### **å»ºè®®1: æ¸¸æˆä¸­ç¦æ­¢åˆ·æ–°**

```javascript
// room-simple.js
window.addEventListener('beforeunload', (e) => {
    if (this.gameState === 'playing') {
        e.preventDefault();
        e.returnValue = 'æ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
        return e.returnValue;
    }
});
```

### **å»ºè®®2: æ¸¸æˆçŠ¶æ€æ¢å¤**

```javascript
// åŽç«¯ä¿å­˜æ¸¸æˆçŠ¶æ€åˆ°æ•°æ®åº“æˆ–å†…å­˜
// çŽ©å®¶é‡æ–°åŠ å…¥æ—¶æ¢å¤çŠ¶æ€
if (player.wasInGame) {
    // æ¢å¤æ¸¸æˆçŠ¶æ€
    socket.emit('game_state_restored', savedGameState);
}
```

### **å»ºè®®3: ä¼˜é›…çš„é‡è¿žæç¤º**

```javascript
// å‰ç«¯æ˜¾ç¤ºé‡è¿žçŠ¶æ€
this.socket.on('disconnect', () => {
    this.showReconnectingMessage();
});

this.socket.on('connect', () => {
    this.hideReconnectingMessage();
    this.rejoinRoom();
});
```

### **å»ºè®®4: é˜²æ­¢å¿«é€Ÿåˆ·æ–°**

```javascript
// æ·»åŠ åˆ·æ–°èŠ‚æµ
let lastRefreshTime = 0;
window.addEventListener('beforeunload', () => {
    const now = Date.now();
    if (now - lastRefreshTime < 3000) {
        // 3ç§’å†…ä¸å…è®¸å†æ¬¡åˆ·æ–°
        return 'è¯·ç¨åŽå†è¯•';
    }
    lastRefreshTime = now;
});
```

---

## ðŸ“Š **å¯¹æ¯”ï¼šä¸åŒåœºæ™¯ä¸‹çš„F5åˆ·æ–°**

| åœºæ™¯ | çŽ©å®¶çŠ¶æ€ | æˆ¿é—´çŠ¶æ€ | æ¸¸æˆçŠ¶æ€ | ç»“æžœ |
|------|---------|---------|---------|------|
| **æˆ¿é—´ç­‰å¾…ä¸­** | è¢«ç§»é™¤â†’é‡æ–°åŠ å…¥ | 1/3â†’0/3â†’1/3 | æ— æ¸¸æˆ | âœ… æ­£å¸¸ |
| **æ¸¸æˆè¿›è¡Œä¸­** | è¢«ç§»é™¤â†’é‡æ–°åŠ å…¥ | 3/3â†’2/3â†’3/3 | å¯èƒ½ä¸­æ–­ | âš ï¸ çŠ¶æ€ä¸¢å¤± |
| **å¿«é€Ÿåˆ·æ–°** | å¤šæ¬¡ç§»é™¤/åŠ å…¥ | é¢‘ç¹å˜åŒ– | ä¸ç¡®å®š | âš ï¸ ç«žæ€æ¡ä»¶ |
| **æ¸…ç©ºç¼“å­˜åŽåˆ·æ–°** | è¢«ç§»é™¤â†’è·³è½¬ç™»å½• | 1/3â†’0/3 | æ—  | âœ… å¼ºåˆ¶ç™»å½• |

---

## ðŸŽ¯ **æ€»ç»“**

### **å½“å‰å®žçŽ°çš„F5åˆ·æ–°æµç¨‹**

âœ… **ä¼˜ç‚¹**ï¼š
1. è‡ªåŠ¨æ¸…ç†æˆ¿é—´çŠ¶æ€
2. è‡ªåŠ¨é‡æ–°åŠ å…¥æˆ¿é—´
3. ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ
4. æˆ¿é—´çŠ¶æ€æ­£ç¡®

âš ï¸ **ç¼ºç‚¹**ï¼š
1. æ¸¸æˆè¿›è¡Œä¸­åˆ·æ–°ä¼šä¸¢å¤±çŠ¶æ€
2. çŸ­æš‚çš„"æœªè¿žæŽ¥"çŠ¶æ€
3. å¯èƒ½å‡ºçŽ°ç«žæ€æ¡ä»¶

### **æŽ¨èåšæ³•**

1. **ç­‰å¾…ä¸­çš„æˆ¿é—´**ï¼šå…è®¸F5åˆ·æ–°ï¼Œè‡ªåŠ¨é‡æ–°åŠ å…¥ âœ…
2. **æ¸¸æˆè¿›è¡Œä¸­**ï¼šæç¤ºç”¨æˆ·ç¡®è®¤ï¼Œæˆ–ç¦æ­¢åˆ·æ–° âš ï¸
3. **æ·»åŠ é‡è¿žæç¤º**ï¼šæ˜¾ç¤º"æ­£åœ¨é‡æ–°è¿žæŽ¥..." ðŸ’¡
4. **æ¸¸æˆçŠ¶æ€ä¿å­˜**ï¼šè€ƒè™‘ä¿å­˜æ¸¸æˆè¿›åº¦ ðŸ’¡

### **ç”¨æˆ·ä½“éªŒ**

å¯¹äºŽæ™®é€šç”¨æˆ·ï¼š
- åœ¨å¤§åŽ…æˆ–ç­‰å¾…æˆ¿é—´ä¸­æŒ‰F5ï¼šâœ… æ— æ„ŸçŸ¥ï¼Œè‡ªåŠ¨æ¢å¤
- åœ¨æ¸¸æˆä¸­æŒ‰F5ï¼šâš ï¸ å¯èƒ½ä¸¢å¤±è¿›åº¦ï¼Œéœ€è¦æç¤º

---

## ðŸ” **å®žé™…æµ‹è¯•å»ºè®®**

1. **æµ‹è¯•åœºæ™¯1**ï¼šæˆ¿é—´ç­‰å¾…ä¸­åˆ·æ–°
   - çŽ©å®¶AåŠ å…¥æˆ¿é—´A05
   - æŒ‰F5åˆ·æ–°
   - **æœŸæœ›**ï¼šè‡ªåŠ¨é‡æ–°åŠ å…¥ï¼Œæˆ¿é—´æ˜¾ç¤ºæ­£å¸¸

2. **æµ‹è¯•åœºæ™¯2**ï¼šæ¸¸æˆä¸­åˆ·æ–°
   - 3ä¸ªçŽ©å®¶å¼€å§‹æ¸¸æˆ
   - çŽ©å®¶AæŒ‰F5åˆ·æ–°
   - **è§‚å¯Ÿ**ï¼šæ¸¸æˆæ˜¯å¦ä¸­æ–­ï¼ŒçŠ¶æ€æ˜¯å¦ä¸¢å¤±

3. **æµ‹è¯•åœºæ™¯3**ï¼šå¿«é€Ÿåˆ·æ–°
   - çŽ©å®¶Aåœ¨æˆ¿é—´ä¸­
   - å¿«é€ŸæŒ‰3æ¬¡F5
   - **è§‚å¯Ÿ**ï¼šæ˜¯å¦æœ‰é”™è¯¯ï¼Œæˆ¿é—´çŠ¶æ€æ˜¯å¦æ­£ç¡®

4. **æµ‹è¯•åœºæ™¯4**ï¼šæ¸…ç©ºç¼“å­˜åŽåˆ·æ–°
   - çŽ©å®¶Aåœ¨æˆ¿é—´ä¸­
   - æ¸…ç©ºlocalStorage
   - æŒ‰F5åˆ·æ–°
   - **æœŸæœ›**ï¼šè·³è½¬åˆ°ç™»å½•é¡µ
