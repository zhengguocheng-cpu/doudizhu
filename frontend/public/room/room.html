<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–—åœ°ä¸»æ¸¸æˆæˆ¿é—´</title>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/room/css/room.css">
    <!-- <link rel="stylesheet" href="room.css"> -->
</head>
<body>
    <div class="main-container">
        <!-- é¡¶éƒ¨æ·±è“è‰²æ ‡é¢˜æ  -->
        <header class="top-header">
            <h1>æ¸¸æˆæˆ¿é—´ -  <span id="currentRoomId"></span></h1>
            <button id="exitGameBtn" class="btn btn-warning" style="display: none;">é€€å‡ºæ¸¸æˆ</button>
            <div class="connection-status" id="connectionStatus">æœªè¿æ¥</div>
        </header>
        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- æ¸¸æˆåŒºåŸŸ -->
            <section class="game-area" id="gameRoom">

                <!-- ç»¿è‰²æ¸¸æˆæ¡Œé¢ -->
                <div class="game-table">
                    <!-- åº•ç‰Œæ˜¾ç¤ºåŒºåŸŸ - æ¡Œé¢é¡¶ç«¯ä¸­é—´ -->
                    <div class="bottom-cards-display" id="bottomCardsDisplay" style="display: none;">
                        <div class="bottom-cards-container" id="bottomCardsContainer">
                            <!-- 3å¼ åº•ç‰Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- ç©å®¶ä½ç½®ç­‰æ¸¸æˆå…ƒç´  -->
                    <!-- é¡¶éƒ¨å·¦ä¾§ç©å®¶ (ç©å®¶2) -->
                    <div class="player-position top-left-player hidden" id="topLeftPlayer">
                        <div class="player-avatar-square">
                            <div class="avatar-square" id="topLeftPlayerAvatar">ğŸ²</div>
                        </div>
                        <div class="player-info">
                            <div class="player-name" id="topLeftPlayerName">ç©å®¶2</div>
                            <div class="player-cards-count" id="topLeftCardCount">æœªå‡†å¤‡</div>
                        </div>
                    </div>

                    <!-- é¡¶éƒ¨å³ä¾§ç©å®¶ (ç©å®¶3) -->
                    <div class="player-position top-right-player hidden" id="topRightPlayer">
                        <div class="player-avatar-square">
                            <div class="avatar-square" id="topRightPlayerAvatar">ğŸ¯</div>
                        </div>
                        <div class="player-info">
                            <div class="player-name" id="topRightPlayerName">ç©å®¶3</div>
                            <div class="player-cards-count" id="topRightCardCount">æœªå‡†å¤‡</div>
                        </div>
                    </div>

                    <!-- åº•éƒ¨ç©å®¶ (å½“å‰ç©å®¶) -->
                    <div class="player-position bottom-player current-player" id="currentPlayerPosition">
                        <div class="player-info">
                            <div class="avatar-square current-avatar" id="currentPlayerAvatar">ğŸ‘‘</div>
                            <div class="player-name" id="currentPlayerNameDisplay">æˆ‘</div>
                            <div class="player-cards-count" id="currentPlayerCardCount">æœªå‡†å¤‡</div>
                        </div>
                    </div>

                    <!-- æ¡Œé¢ä¸­å¤®å‘ç‰ŒåŠ¨ç”»åŒºåŸŸ - ç§»åˆ°game-tableå†…éƒ¨ -->
                    <div class="center-dealing-area" id="centerDealingArea" style="display: none;">
                        <div class="dealing-cards-container" id="dealingCardsContainer">
                            <!-- å‘ç‰ŒåŠ¨ç”»å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <div class="dealing-message" id="dealingMessage">æ­£åœ¨å‘ç‰Œ...</div>
                    </div>

                    <!-- ä¸Šå®¶å‡ºç‰Œæ˜¾ç¤ºåŒºåŸŸ - æ¡Œé¢ä¸­å¤® -->
                    <div class="played-cards-area" id="playedCardsArea" style="display: none;">
                        <div class="played-cards-label" id="playedCardsLabel">ä¸Šå®¶å‡ºç‰Œ</div>
                        <div class="played-cards-container" id="playedCardsContainer">
                            <!-- ä¸Šå®¶å‡ºçš„ç‰Œå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>
                </div>

                <!-- å½“å‰ç©å®¶æ‰‹ç‰ŒåŒºåŸŸ -->
                <div class="player-hand-section">
                    <div class="cards-display player-hand" id="playerHand">
                        <!-- ç©å®¶æ‰‹ç‰Œå°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ä¸­å¤®æ§åˆ¶åŒºåŸŸ - è¦†ç›–åœ¨æ¸¸æˆæ¡Œé¢ä¹‹ä¸Š -->
                <div class="game-controls-overlay" id="gameControlsOverlay">
                    <!-- æˆ¿é—´æ“ä½œæŒ‰é’® - æ¸¸æˆå¼€å§‹å‰æ˜¾ç¤º -->
                    <div class="room-actions" id="roomActions">
                        <button id="startGameBtn" class="btn btn-success btn-lg">å¼€å§‹æ¸¸æˆ</button>
                        <button id="leaveRoomBtn" class="btn btn-danger btn-lg">è¿”å›å¤§å…</button>
                    </div>

                    <!-- æŠ¢åœ°ä¸»æ“ä½œæŒ‰é’® - æŠ¢åœ°ä¸»é˜¶æ®µæ˜¾ç¤º -->
                    <div class="bidding-actions" id="biddingActions" style="display: none;">
                        <div class="bidding-timer" id="biddingTimer">15</div>
                        <div class="bidding-buttons">
                            <button id="bidBtn" class="btn btn-warning btn-lg">æŠ¢åœ°ä¸»</button>
                            <button id="noBidBtn" class="btn btn-secondary btn-lg">ä¸æŠ¢</button>
                        </div>
                        <div class="bidding-hint" id="biddingHint">è¯·é€‰æ‹©æ˜¯å¦æŠ¢åœ°ä¸»</div>
                    </div>

                    <!-- å‡ºç‰Œæ“ä½œæŒ‰é’® - è½®åˆ°ç©å®¶æ—¶æ˜¾ç¤º -->
                    <div class="game-actions" id="gameActions" style="display: none;">
                        <button id="hintBtn" class="btn btn-info btn-lg">æç¤º</button>
                        <button id="playCardsBtn" class="btn btn-primary btn-lg">å‡ºç‰Œ</button>
                        <button id="passBtn" class="btn btn-secondary btn-lg">ä¸å‡º</button>
                    </div>
                </div>
            </section>

            <!-- å³ä¾§èŠå¤©åŒºåŸŸ -->
            <aside class="chat-sidebar">
                <div class="chat-header">
                    <h3>æˆ¿é—´èŠå¤©</h3>
                </div>
                <div class="chat-messages" id="roomMessageLog" style="background-color: #27ae60; min-height: 100px;">
                    <!-- èŠå¤©æ¶ˆæ¯å°†åŠ¨æ€æ·»åŠ  -->
                </div>
                <div class="chat-input-area">
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="è¾“å…¥èŠå¤©æ¶ˆæ¯...">
                        <button id="sendChatBtn" class="btn btn-primary">å‘é€</button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- æ¸¸æˆç»“ç®—å¼¹çª— -->
        <div id="gameSettlementModal" class="settlement-modal" style="display: none;">
            <div class="settlement-overlay"></div>
            <div class="settlement-content">
                <div class="settlement-header">
                    <h2 id="settlementTitle">æ¸¸æˆç»“æŸ</h2>
                </div>
                <div class="settlement-body">
                    <div class="winner-info">
                        <div class="winner-avatar" id="winnerAvatar">ğŸ‘‘</div>
                        <div class="winner-name" id="winnerName">ç©å®¶1</div>
                        <div class="winner-role" id="winnerRole">åœ°ä¸»</div>
                    </div>
                    <div class="score-details">
                        <div class="score-item">
                            <span class="score-label">åŸºç¡€åˆ†ï¼š</span>
                            <span class="score-value" id="baseScore">1</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">å€æ•°ï¼š</span>
                            <span class="score-value" id="multiplier">Ã—1</span>
                        </div>
                        <div class="score-item total-score">
                            <span class="score-label">æ€»å¾—åˆ†ï¼š</span>
                            <span class="score-value" id="totalScore">+1</span>
                        </div>
                    </div>
                    <div class="players-score">
                        <div class="player-score-item" id="player1Score"></div>
                        <div class="player-score-item" id="player2Score"></div>
                        <div class="player-score-item" id="player3Score"></div>
                    </div>
                </div>
                <div class="settlement-footer">
                    <button id="playAgainBtn" class="btn btn-primary btn-lg">å†æ¥ä¸€å±€</button>
                    <button id="backToLobbyBtn" class="btn btn-secondary btn-lg">è¿”å›å¤§å…</button>
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•æ§åˆ¶é¢æ¿ -->
        <div id="debugPanel" style="position: fixed; bottom: 20px; left: 200px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000; display: none;">
            <div><strong>è°ƒè¯•é¢æ¿</strong></div>
            <button onclick="testRoomJoined()" style="margin: 2px; padding: 2px 5px; font-size: 10px;">æ¨¡æ‹Ÿroom_joined</button>
            <button onclick="testPlayerJoined()" style="margin: 2px; padding:2px 5px; font-size: 10px;">æ¨¡æ‹Ÿplayer_joined</button>
            <button onclick="testShowButtons()" style="margin: 2px; padding: 2px 5px; font-size: 10px;">æ˜¾ç¤ºæŒ‰é’®</button>
            <button onclick="testHideButtons()" style="margin: 2px; padding: 2px 5px; font-size: 10px;">éšè—æŒ‰é’®</button>
        </div>

        <script>
            function testRoomJoined() {
                console.log('æ‰‹åŠ¨è§¦å‘ room_joined æµ‹è¯•');
                // æ¨¡æ‹ŸæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯
                window.dispatchEvent(new CustomEvent('test-room-joined'));
            }

            function testPlayerJoined() {
                console.log('æ‰‹åŠ¨è§¦å‘ player_joined æµ‹è¯•');
                window.dispatchEvent(new CustomEvent('test-player-joined'));
            }

            function testShowButtons() {
                console.log('æ‰‹åŠ¨æ˜¾ç¤ºæŒ‰é’®');
                const overlay = document.getElementById('gameControlsOverlay');
                const actions = document.getElementById('roomActions');
                if (overlay) overlay.style.display = 'flex';
                if (actions) actions.style.display = 'flex';
            }

            function testHideButtons() {
                console.log('æ‰‹åŠ¨éšè—æŒ‰é’®');
                const overlay = document.getElementById('gameControlsOverlay');
                const actions = document.getElementById('roomActions');
                if (overlay) overlay.style.display = 'none';
                if (actions) actions.style.display = 'none';
            }
        </script>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/global-socket.js"></script>
        <script src="/room/js/CardTypeDetector.js"></script>
        <script src="/room/js/CardValidator.js"></script>
        <script src="/room/js/room-simple.js"></script>
    </div>
</body>
</html>
