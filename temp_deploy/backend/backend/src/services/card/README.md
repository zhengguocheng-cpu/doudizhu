# CardService - æ‰‘å…‹ç‰ŒæœåŠ¡æ¨¡å—

## ğŸ“– æ¦‚è¿°

CardServiceæ˜¯æ–—åœ°ä¸»æ¸¸æˆçš„æ ¸å¿ƒæœåŠ¡æ¨¡å—ï¼Œè´Ÿè´£æ‰€æœ‰ä¸æ‰‘å…‹ç‰Œç›¸å…³çš„æ“ä½œã€‚é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†åŸæœ¬åœ¨GameServiceä¸­çš„æ‰‘å…‹ç‰Œé€»è¾‘æ‹†åˆ†åˆ°ç‹¬ç«‹çš„æœåŠ¡ä¸­ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
card/
â”œâ”€â”€ cardGenerator.ts   # æ‰‘å…‹ç‰Œç”Ÿæˆå™¨
â”œâ”€â”€ cardShuffler.ts    # æ´—ç‰Œç®—æ³•æœåŠ¡
â”œâ”€â”€ cardValidator.ts   # ç‰Œå‹éªŒè¯å™¨
â”œâ”€â”€ cardService.ts     # ä¸»è¦æœåŠ¡æ¥å£
â””â”€â”€ example.ts         # ä½¿ç”¨ç¤ºä¾‹
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### **CardGenerator** - æ‰‘å…‹ç‰Œç”Ÿæˆå™¨
- âœ… ç”Ÿæˆæ ‡å‡†54å¼ æ‰‘å…‹ç‰Œï¼ˆå«å¤§å°ç‹ï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰ç‰Œæ•°ç”Ÿæˆ
- âœ… æä¾›å‹å¥½æ˜¾ç¤ºåç§°è½¬æ¢
- âœ… å­—ç¬¦ä¸²ä¸Cardå¯¹è±¡äº’è½¬

### **CardShuffler** - æ´—ç‰Œç®—æ³•æœåŠ¡
- âœ… Fisher-Yatesæ ‡å‡†æ´—ç‰Œç®—æ³•
- âœ… å¤šæ¬¡æ´—ç‰Œå¢åŠ éšæœºæ€§
- âœ… åˆ‡ç‰Œ+æ´—ç‰Œæ¨¡æ‹ŸçœŸå®æ“ä½œ
- âœ… æ´—ç‰Œå…¬å¹³æ€§éªŒè¯å·¥å…·

### **CardValidator** - ç‰Œå‹éªŒè¯å™¨
- âœ… å‡ºç‰Œåˆæ³•æ€§éªŒè¯
- âœ… ç©å®¶æ‰‹ç‰Œæ£€æŸ¥
- âœ… æˆ¿é—´ç©å®¶æ•°é‡éªŒè¯
- âœ… æ¸¸æˆå¼€å§‹æ¡ä»¶éªŒè¯

### **CardService** - ä¸»è¦æœåŠ¡æ¥å£
- âœ… æ™ºèƒ½å‘ç‰Œï¼ˆ17å¼ æ‰‹ç‰Œ+3å¼ åº•ç‰Œï¼‰
- âœ… å‡ºç‰ŒéªŒè¯API
- âœ… ç‰Œé¢å‹å¥½æ˜¾ç¤º
- âœ… æ´—ç‰Œå…¬å¹³æ€§æµ‹è¯•

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **åŸºæœ¬å‘ç‰Œ**
```typescript
import { cardService } from './services/card/cardService';

// ä¸º3ä¸ªç©å®¶å‘ç‰Œ
const result = cardService.dealCards(3);
console.log(`ç©å®¶1: ${result.playerCards[0].length}å¼ ç‰Œ`);
console.log(`åº•ç‰Œ: ${result.bottomCards.length}å¼ ç‰Œ`);
```

### **å‡ºç‰ŒéªŒè¯**
```typescript
// éªŒè¯ç©å®¶æ˜¯å¦å¯ä»¥å‡ºè¿™äº›ç‰Œ
const validation = cardService.validatePlay(playerCards, playedCards);
if (validation.valid) {
  console.log('å‡ºç‰Œæœ‰æ•ˆ');
} else {
  console.log('å‡ºç‰Œæ— æ•ˆ:', validation.error);
}
```

### **å‹å¥½æ˜¾ç¤º**
```typescript
// å°†æ‰‘å…‹ç‰Œè½¬æ¢ä¸ºå‹å¥½æ˜¾ç¤ºæ ¼å¼
const displayNames = cardService.getCardsDisplayNames(['heartsA', 'spadesK']);
console.log(displayNames); // ['â™¥A', 'â™ K']
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

- **æ´—ç‰Œç®—æ³•**: O(n)æ—¶é—´å¤æ‚åº¦ï¼ŒO(1)ç©ºé—´å¤æ‚åº¦
- **å‘ç‰Œç®—æ³•**: è‡ªåŠ¨åˆ†é…ï¼Œå…¬å¹³éšæœº
- **éªŒè¯ç®—æ³•**: O(n)çº¿æ€§éªŒè¯é€Ÿåº¦
- **å†…å­˜ä¼˜åŒ–**: é¿å…é‡å¤åˆ›å»ºç‰Œå®ä¾‹

## ğŸ§ª æµ‹è¯•è¦†ç›–

CardServiceåŒ…å«å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å’Œå…¬å¹³æ€§éªŒè¯ï¼š

```typescript
// è¿è¡Œå…¬å¹³æ€§æµ‹è¯•
const isFair = cardService.validateShuffleFairness(1000);
console.log(`æ´—ç‰Œç®—æ³•æ˜¯å¦å…¬å¹³: ${isFair}`);
```

## ğŸ”§ APIæ¥å£

### **HTTP API**
```http
POST /api/games/rooms/{roomId}/validate-play
Content-Type: application/json

{
  "playerId": "player123",
  "cards": ["hearts3", "hearts4", "hearts5"]
}
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "message": "å‡ºç‰Œæœ‰æ•ˆ"
}
```

## ğŸ’¡ è®¾è®¡ä¼˜åŠ¿

1. **å•ä¸€èŒè´£**: æ¯ä¸ªå­æœåŠ¡ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½
2. **é«˜å†…èš**: æ‰‘å…‹ç‰Œç›¸å…³æ“ä½œé›†ä¸­ç®¡ç†
3. **æ˜“æµ‹è¯•**: ç‹¬ç«‹æ¨¡å—ä¾¿äºå•å…ƒæµ‹è¯•
4. **å¯æ‰©å±•**: æ”¯æŒæœªæ¥æ·»åŠ æ›´å¤šç‰Œå‹è§„åˆ™
5. **æ€§èƒ½ä¼˜åŒ–**: ä¸“ç”¨ç®—æ³•ï¼Œæ‰§è¡Œæ•ˆç‡é«˜

## ğŸ”„ è¿ç§»è¯´æ˜

ä»GameServiceè¿ç§»åˆ°CardServiceçš„æ”¹åŠ¨ï¼š

**ä¹‹å‰**:
```typescript
// åœ¨GameServiceä¸­
private generateCards(): Card[] { /* 150è¡Œä»£ç  */ }
private shuffleCards(cards: Card[]): void { /* æ´—ç‰Œé€»è¾‘ */ }
```

**ç°åœ¨**:
```typescript
// ä½¿ç”¨CardService
const dealResult = cardService.dealCards(playerCount);
player.cards = dealResult.playerCards[index];
```

## ğŸ® å®é™…åº”ç”¨

åœ¨æ–—åœ°ä¸»æ¸¸æˆä¸­çš„ä½¿ç”¨åœºæ™¯ï¼š

1. **æ¸¸æˆå¼€å§‹**: è‡ªåŠ¨å‘ç‰Œç»™æ‰€æœ‰ç©å®¶
2. **å‡ºç‰Œé˜¶æ®µ**: éªŒè¯ç©å®¶å‡ºç‰Œåˆæ³•æ€§
3. **æ˜¾ç¤ºç•Œé¢**: æä¾›å‹å¥½çš„ç‰Œé¢æ˜¾ç¤º
4. **è§„åˆ™æ£€æŸ¥**: ç¡®ä¿æ¸¸æˆæŒ‰è§„åˆ™è¿›è¡Œ

---

**CardServiceè®©æ‰‘å…‹ç‰Œæ“ä½œå˜å¾—ç®€å•ã€é«˜æ•ˆå’Œå¯é ï¼** ğŸ¯
